/********************************************************************************
**
** 文件名:     at_com.c
** 版权所有:   (c) 2007-2008 厦门雅迅网络股份有限公司
** 文件描述:   该模块主要实现手机模块通信通道配置和管理
**
*********************************************************************************
**             修改历史记录
**===============================================================================
**| 日期       | 作者   |  修改记录
**===============================================================================
**| 2014/06/15 | 叶德焰 |  创建第一版本
*********************************************************************************/
#include "yx_include.h"
#include "yx_misc.h"
#include "at_com.h"
#include "at_power.h"

#if EN_AT > 0

/*
********************************************************************************
* 定义模块配置参数
********************************************************************************
*/
#define UART_COM_GSM         UART_COM_2


/*
********************************************************************************
* 定义模块数据结构
********************************************************************************
*/


/*
********************************************************************************
* 定义模块变量
********************************************************************************
*/

/*******************************************************************
** 函数名:     AT_COM_PullUp
** 函数描述:   打开电源
** 参数:       无
** 返回:       无
********************************************************************/
void AT_COM_PullUp(void)
{
    AT_POWER_PowerOn();
}

/*******************************************************************
** 函数名:     AT_COM_PullDown
** 函数描述:   关掉电源
** 参数:       无
** 返回:       无
********************************************************************/
void AT_COM_PullDown(void)
{
    AT_POWER_PowerOff();
}

/*******************************************************************
** 函数名:     AT_COM_Init
** 函数描述:   初始化函数
** 参数:       无
** 返回:       无
********************************************************************/
void AT_COM_Init(void)
{
    //AT_COM_SetBaud(9600);
}

/*******************************************************************
** 函数名:     AT_COM_SetBaud
** 函数描述:   初始化串口波特率
** 参数:       [in] baud:波特率1200-115200
** 返回:       无
********************************************************************/
void AT_COM_SetBaud(INT32U baud)
{
    UART_CFG_T cfg;
    
    //ST_UART_CloseUart(UART_COM_0);
    
    cfg.com     = UART_COM_GSM;
    cfg.baud    = baud;
    cfg.parity  = UART_PARITY_NONE;
    cfg.databit = UART_DATABIT_8;
    cfg.stopbit = UART_STOPBIT_1;
    
    cfg.rx_fcm  = UART_FCM_NULL;
    cfg.tx_fcm  = UART_FCM_NULL;
    
    cfg.rx_len  = 512;
    cfg.tx_len  = 512;
    
    ST_UART_OpenUart(&cfg);
}

/*******************************************************************
** 函数名:     AT_COM_CloseUart
** 函数描述:   关闭串口
** 参数:       无
** 返回:       无
********************************************************************/
void AT_COM_CloseUart(void)
{
    ST_UART_CloseUart(UART_COM_GSM);
}

/*******************************************************************
** 函数名:     AT_COM_ReadByte
** 函数描述:   通道数据接收接口
** 参数:       无
** 返回:       数据，无数据返回－1
********************************************************************/
INT32S AT_COM_ReadByte(void)
{
    return ST_UART_ReadChar(UART_COM_GSM);
}

/*******************************************************************
** 函数名:     AT_COM_SendData
** 函数描述:   发送数据
** 参数:       [in] ptr: 数据指针
**              [in] len: 数据长度
** 返回:       成功返回true，失败返回false
********************************************************************/
BOOLEAN AT_COM_SendData(INT8U *ptr, INT16U len)
{
    return ST_UART_WriteBlock(UART_COM_GSM, ptr, len);
}


#endif

